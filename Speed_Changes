wait(2.5)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- GUI Setup
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "SpeedChangerGUI"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 250, 0, 150)
frame.Position = UDim2.new(0.5, -125, 0.6, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Active = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.Text = "Keep Going"
title.TextColor3 = Color3.new(1,1,1)
title.BackgroundTransparency = 1
title.Font = Enum.Font.SourceSansBold
title.TextScaled = true

local textbox = Instance.new("TextBox", frame)
textbox.Position = UDim2.new(0.1, 0, 0.3, 0)
textbox.Size = UDim2.new(0.8, 0, 0.2, 0)
textbox.PlaceholderText = "Number only"
textbox.Text = ""
textbox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
textbox.TextColor3 = Color3.new(1,1,1)
textbox.Font = Enum.Font.SourceSans
textbox.TextScaled = true

local applyButton = Instance.new("TextButton", frame)
applyButton.Position = UDim2.new(0.1, 0, 0.55, 0)
applyButton.Size = UDim2.new(0.35, 0, 0.2, 0)
applyButton.Text = "Dagan"
applyButton.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
applyButton.TextColor3 = Color3.new(1,1,1)
applyButton.Font = Enum.Font.SourceSansBold
applyButton.TextScaled = true

local stopButton = Instance.new("TextButton", frame)
stopButton.Position = UDim2.new(0.55, 0, 0.55, 0)
stopButton.Size = UDim2.new(0.35, 0, 0.2, 0)
stopButton.Text = "Sho"
stopButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
stopButton.TextColor3 = Color3.new(1,1,1)
stopButton.Font = Enum.Font.SourceSansBold
stopButton.TextScaled = true

local statusLabel = Instance.new("TextLabel", frame)
statusLabel.Position = UDim2.new(0.1, 0, 0.8, 0)
statusLabel.Size = UDim2.new(0.8, 0, 0.15, 0)
statusLabel.Text = "Status: Idle"
statusLabel.TextColor3 = Color3.new(1,1,1)
statusLabel.BackgroundTransparency = 1
statusLabel.Font = Enum.Font.SourceSansItalic
statusLabel.TextScaled = true

-- ðŸ”˜ Toggle Button (Hide/Show)
local toggleButton = Instance.new("TextButton", gui)
toggleButton.Size = UDim2.new(0, 80, 0, 30)
toggleButton.Position = UDim2.new(0.5, -40, 0.9, 0)
toggleButton.Text = "Hide"
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleButton.TextColor3 = Color3.new(1,1,1)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextScaled = true

-- Vars
local frameVisible = true
local currentSpeed = 0
local isRunning = false
local autoControl = false
local sessionId = 0  -- pang control ng loop

-- Toggle Hide/Show
toggleButton.MouseButton1Click:Connect(function()
	frameVisible = not frameVisible
	frame.Visible = frameVisible
	toggleButton.Text = frameVisible and "Hide" or "Show"
end)

-- Apply speed button (Dagan)
applyButton.MouseButton1Click:Connect(function()
	local newSpeed = tonumber(textbox.Text)
	if newSpeed then
		currentSpeed = newSpeed
		isRunning = true
		autoControl = true
		sessionId += 1 -- bagong session start
		local mySession = sessionId
		statusLabel.Text = "Status: Running"

		-- start auto loop
		task.spawn(function()
			while autoControl and mySession == sessionId do
				-- race
				isRunning = true
				statusLabel.Text = "Status: Running (Race)"
				task.wait(120)
				if not (autoControl and mySession == sessionId) then break end

				-- break
				isRunning = false
				statusLabel.Text = "Status: Waiting (Break)"
				task.wait(52)
				if not (autoControl and mySession == sessionId) then break end

				-- countdown
				for i = 3,1,-1 do
					if not (autoControl and mySession == sessionId) then break end
					statusLabel.Text = "Race starts in: " .. i
					task.wait(1)
				end
			end
		end)
	end
end)

-- Stop button (Sho)
stopButton.MouseButton1Click:Connect(function()
	isRunning = false
	currentSpeed = 0
	autoControl = false
	sessionId += 1 -- putulin lahat ng lumang loop
	if hrp then
		hrp.Velocity = Vector3.zero
	end
	statusLabel.Text = "Status: Idle"
end)

-- Movement loop
RunService.RenderStepped:Connect(function()
	if character and hrp then
		if isRunning then
			hrp.Velocity = hrp.CFrame.LookVector * currentSpeed
		end
	end
end)

-- Respawn reconnect
player.CharacterAdded:Connect(function(newChar)
	character = newChar
	hrp = character:WaitForChild("HumanoidRootPart")
	statusLabel.Text = "Status: Ready (New Race)"
	if isRunning then
		task.wait(1)
		statusLabel.Text = "Status: Running"
	end
end)

-- Dragging (main frame)
do
	local dragging, dragInput, dragStart, startPos
	local function update(input)
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end
	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	frame.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if dragging and input == dragInput then
			update(input)
		end
	end)
end

-- Dragging (toggle button)
do
	local dragging, dragInput, dragStart, startPos
	local function update(input)
		local delta = input.Position - dragStart
		toggleButton.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end
	toggleButton.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = toggleButton.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	toggleButton.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if dragging and input == dragInput then
			update(input)
		end
	end)
end

-- ðŸ“Œ Connected Popup Insert
local Lighting = game:GetService("Lighting")

-- Max blur effect
local blur = Instance.new("BlurEffect")
blur.Size = 50
blur.Parent = Lighting

-- Popup GUI
local popupGui = Instance.new("ScreenGui")
popupGui.Name = "ConnectedPopup"
popupGui.ResetOnSpawn = false
popupGui.Parent = player:WaitForChild("PlayerGui")

local popupFrame = Instance.new("Frame", popupGui)
popupFrame.Size = UDim2.new(0, 400, 0, 200)
popupFrame.Position = UDim2.new(0.5, -200, 0.5, -100)
popupFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
popupFrame.BorderColor3 = Color3.fromRGB(255, 255, 255)
popupFrame.BorderSizePixel = 1

-- Title
local popupTitle = Instance.new("TextLabel", popupFrame)
popupTitle.Size = UDim2.new(1, 0, 0, 50)
popupTitle.Text = "Connected"
popupTitle.Font = Enum.Font.SourceSansBold
popupTitle.TextSize = 28
popupTitle.TextColor3 = Color3.new(1,1,1)
popupTitle.BackgroundTransparency = 1

-- Line
local line = Instance.new("Frame", popupFrame)
line.Size = UDim2.new(1, -20, 0, 1)
line.Position = UDim2.new(0, 10, 0, 50)
line.BackgroundColor3 = Color3.fromRGB(200,200,200)

-- Message
local popupMsg = Instance.new("TextLabel", popupFrame)
popupMsg.Size = UDim2.new(1, -20, 0, 80)
popupMsg.Position = UDim2.new(0, 10, 0, 60)
popupMsg.Text = "Welcome to Speed Changer!\nEnjoy your game."
popupMsg.Font = Enum.Font.SourceSans
popupMsg.TextSize = 20
popupMsg.TextColor3 = Color3.new(1,1,1)
popupMsg.TextWrapped = true
popupMsg.BackgroundTransparency = 1

-- Continue Button
local continueBtn = Instance.new("TextButton", popupFrame)
continueBtn.Size = UDim2.new(0, 120, 0, 40)
continueBtn.Position = UDim2.new(0.5, -60, 1, -60)
continueBtn.Text = "Continue"
continueBtn.Font = Enum.Font.SourceSansBold
continueBtn.TextSize = 22
continueBtn.TextColor3 = Color3.new(0,0,0)
continueBtn.BackgroundColor3 = Color3.fromRGB(245,245,245)

-- Hide muna main GUI
frame.Visible = false
toggleButton.Visible = false

-- Pag click ng continue
continueBtn.MouseButton1Click:Connect(function()
    blur:Destroy()
    popupGui:Destroy()
    frame.Visible = true
    toggleButton.Visible = true
end)
